# ASR Service Configuration

# Model settings
model:
  name: "large-v3"          # tiny, base, small, medium, large-v3
  device: "cuda"             # cuda or cpu
  device_index: 0            # GPU index (0 for first 3090, 1 for second)
  compute_type: "float16"    # float16, int8, int8_float16
  download_root: "./models"  # Model cache directory

# VAD settings
vad:
  type: "hybrid"             # hybrid (Smart Turn + fallback)

  smart_turn:
    enabled: true
    model_path: "./models/smart-turn-v3.onnx"  # Download from HuggingFace
    confidence_threshold: 0.7

  fallback:
    enabled: true
    silence_timeout: 1.5     # seconds
    min_speech_duration: 0.8 # seconds

  quality_gating:
    enabled: true
    min_snr: 0.3             # Minimum signal-to-noise ratio

# Audio processing
audio:
  target_sample_rate: 16000
  max_buffer_duration: 30.0  # seconds

  # Supported input formats (auto-detected)
  supported_formats:
    - "float32"
    - "int16"
    - "mulaw"                # Twilio/phone systems

# Server settings
server:
  host: "0.0.0.0"
  port: 8001
  max_connections: 50        # Can handle way more with your hardware
  connection_timeout: 300    # seconds

# Queue settings (prevent data loss)
queues:
  input_queue_size: 1000     # Audio chunks (~60 seconds)
  processing_queue_size: 100 # GPU queue
  output_queue_size: 500     # Per-connection results

  # Batching for efficiency
  batch_timeout_ms: 50       # Max wait for batching
  max_batch_size: 16         # Max items per batch

# Rate limiting (prevent abuse)
rate_limiting:
  enabled: true
  max_requests_per_minute: 100
  window_seconds: 60

# Logging
logging:
  level: "INFO"              # DEBUG, INFO, WARNING, ERROR
  format: "json"             # json or text
  file: "./logs/asr.log"

  # Log specific events
  log_transcriptions: true
  log_vad_events: false      # Can be noisy
  log_audio_stats: false

# Performance
performance:
  enable_warmup: true        # Warm up GPU at startup
  beam_size: 5               # ASR beam search (1-10, lower is faster)
  word_timestamps: true      # Enable word-level timestamps

# Monitoring
monitoring:
  enable_health_endpoint: true
  enable_metrics_endpoint: true
  metrics_port: 9091         # Prometheus metrics (optional)
